<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Laxmi Sales – Bill Generator</title>

<style>
body{
    font-family:"Segoe UI",Arial,sans-serif;
    background:#f4f6f8;
    padding:20px;
}
h1{text-align:center;margin-bottom:4px;}
h2{text-align:center;color:#666;margin-top:0;}
.controls{text-align:center;margin:20px 0;}
select,button{padding:8px 14px;font-size:14px;margin:5px;}
button{
    background:#2c3e50;color:white;border:none;
    border-radius:6px;cursor:pointer;
}
button:hover{background:#1f2d3a;}
.bill{
    background:white;margin:20px 0;padding:15px;
    border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.bill-header{
    display:flex;justify-content:space-between;
    flex-wrap:wrap;font-size:14px;margin-bottom:8px;
}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #333;padding:6px;text-align:center;}
th{background:#f0f0f0;}
.totals{text-align:right;margin-top:10px;font-size:14px;}
</style>
</head>

<body>

<h1>Shree Laxmi Sales</h1>
<h2>Bill Generator</h2>

<div class="controls">
<select id="month">
<option value="0">January</option><option value="1">February</option>
<option value="2">March</option><option value="3">April</option>
<option value="4">May</option><option value="5">June</option>
<option value="6">July</option><option value="7">August</option>
<option value="8">September</option><option value="9">October</option>
<option value="10">November</option><option value="11">December</option>
</select>

<select id="year">
<option selected>2025</option><option>2026</option>
</select>

<br><br>
<button onclick="generateBills()">Generate Bills</button>
<button onclick="downloadPDF()">Download PDF</button>
</div>

<div id="output"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script>
const { jsPDF } = window.jspdf;
const output = document.getElementById("output");
const HSN="7117";
const GLOBAL_MAX_QTY=300;

/* Rates */
const itemRates={
Chain:[12,15,20,35],
Pendal:[15,20,25,30],
Mangalsutra:[20,25,30],
Kanthi:[30,35,40],
Ring:[40,45,50],
Set:[165,175,190]
};

const qtyLimits={
Chain:[40,300],
Pendal:[40,300],
Mangalsutra:[20,200],
Kanthi:[20,200],
Ring:[40,300],
Set:[5,60]
};

const namePlace={
Abhay:"Delhi",Vijay:"Delhi","Raj Kumar":"Delhi",Sonu:"Delhi",
Tushar:"Delhi",Naveen:"Delhi","R.S":"Agra",
"Jiva jewellery":"Agra","V.I. Immitation":"Rajkot",
"Pratham Traders":"Rajkot","Vishnu Shankar Prasad":"Bihar"
};

let generatedBills=[],invoiceCounter=1;

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function pick(a){return a[rand(0,a.length-1)];}
function isSunday(d){return d.getDay()===0;}
function recalc(rows){return rows.reduce((s,r)=>s+r.qty*r.rate,0);}

function randomDates(y,m,c){
let d=[],days=new Date(y,m+1,0).getDate();
while(d.length<c){
let x=new Date(y,m,rand(1,days));
if(!isSunday(x)&&!d.some(z=>z.toDateString()==x.toDateString()))d.push(x);
}
return d.sort((a,b)=>a-b);
}

function normalizeBill(rows, minBill, maxBill) {
    let total = recalc(rows);

    // Reduce if too high
    while (total > maxBill) {
        for (let r of rows) {
            if (r.qty > 1) {
                r.qty -= 1;
                r.amt = r.qty * r.rate;
                total = recalc(rows);
                if (total <= maxBill) break;
            }
        }
    }

    // Increase if too low
    while (total < minBill) {
        for (let r of rows) {
            if (r.qty < GLOBAL_MAX_QTY) {
                r.qty += 1;
                r.amt = r.qty * r.rate;
                total = recalc(rows);
                if (total >= minBill) break;
            }
        }
    }

    return total;
}


function generateBills(){
output.innerHTML="";
generatedBills=[];invoiceCounter=1;

const m=parseInt(month.value),y=parseInt(year.value);
const billCount=rand(4,5);
const dates=randomDates(y,m,billCount);

let minBill=billCount===4?10000:8000;
let maxBill=billCount===4?11000:9000;

dates.forEach(date=>{
let rows=[],usedRates=new Set();
let billTarget=rand(minBill,maxBill);
let name=pick(Object.keys(namePlace));
let place=namePlace[name];

// fixed 5–6 items
let itemCount=rand(5,6);

for(let i=0;i<itemCount;i++){
let item=pick(Object.keys(itemRates));
let rate=pick(itemRates[item]);
if(usedRates.has(rate))continue;
usedRates.add(rate);

let[q1,q2]=qtyLimits[item];
let qty=rand(q1,q2);
qty=Math.min(qty,GLOBAL_MAX_QTY);

rows.push({item,qty,rate,amt:qty*rate});
}

let billTotal=recalc(rows);

// fine tuning
let diff=billTarget-billTotal;
if(diff>0){
for(let r of rows){
if(diff<=0)break;
let addQty=Math.min(3,GLOBAL_MAX_QTY-r.qty);
r.qty+=addQty;
r.amt=r.qty*r.rate;
diff-=addQty*r.rate;
}
}

billTotal = normalizeBill(rows, minBill, maxBill);

generatedBills.push({
date,name,place,rows,billTotal,inv:invoiceCounter++
});
});

// render
let monthlySum=0;
generatedBills.forEach(b=>{
monthlySum+=b.billTotal;
let igst=(b.billTotal*0.03).toFixed(2);
let total=(b.billTotal*1.03).toFixed(2);
output.innerHTML+=`
<div class="bill">
<div class="bill-header">
<div><b>Invoice:</b> INV/${y}/${String(b.inv).padStart(3,"0")}</div>
<div><b>Date:</b> ${b.date.toLocaleDateString()}</div>
<div><b>Name:</b> ${b.name}</div>
<div><b>Place:</b> ${b.place}</div>
</div>
<table>
<tr><th>Sr</th><th>Description</th><th>HSN</th><th>Qty</th><th>Rate</th><th>Amount</th></tr>
${b.rows.map((r,i)=>`
<tr>
<td>${i+1}</td><td>${r.item}</td><td>${HSN}</td>
<td>${r.qty}</td><td>${r.rate}</td><td>${r.amt}</td>
</tr>`).join("")}
</table>
<div class="totals">
Total before GST ₹${b.billTotal}<br>
IGST 3% ₹${igst}<br>
<b>Total ₹${total}</b>
</div>
</div>`;
});

output.innerHTML+=`<h3 style="text-align:right;color:green">
Monthly Total: ₹${monthlySum}
</h3>`;
}

function getMonthCode(m){
return["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][m];
}

function downloadPDF(){
const pdf=new jsPDF("p","mm","a4");
generatedBills.forEach((b,i)=>{
if(i)pdf.addPage();
pdf.text("Shree Laxmi Sales",105,12,{align:"center"});
pdf.text(`Invoice: INV/${String(b.inv).padStart(3,"0")}`,14,22);
pdf.text(`Date: ${b.date.toLocaleDateString()}`,150,22);
pdf.text(`Name: ${b.name}`,14,28);
pdf.text(`Place: ${b.place}`,150,28);
pdf.autoTable({
startY:35,
head:[["Sr","Item","HSN","Qty","Rate","Amount"]],
body:b.rows.map((r,i)=>[i+1,r.item,HSN,r.qty,r.rate,r.amt])
});
let y=pdf.lastAutoTable.finalY+6;
pdf.text(`Total before GST : ₹ ${b.billTotal.toFixed(2)}`,20,y);
pdf.text(`IGST @3%        : ₹ ${(b.billTotal*0.03).toFixed(2)}`,20,y+8);
pdf.text(`Total Amount    : ₹ ${(b.billTotal*1.03).toFixed(2)}`,20,y+16);
});
pdf.save(`SLS_${getMonthCode(parseInt(month.value))}_${year.value}_Bill.pdf`);
}
</script>

</body>
</html>
