<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Laxmi Sales – Bill Generator</title>

<style>
body{
    font-family: "Segoe UI", Arial, sans-serif;
    background:#f4f6f8;
    padding:20px;
}
h1{ text-align:center; margin-bottom:4px; }
h2{ text-align:center; color:#666; margin-top:0; }

.controls{
    text-align:center;
    margin:20px 0;
}
select,button{
    padding:8px 14px;
    font-size:14px;
    margin:5px;
}
button{
    background:#2c3e50;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{ background:#1f2d3a; }

.bill{
    background:white;
    margin:20px 0;
    padding:15px;
    border-radius:8px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
}

.bill-header{
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    font-size:14px;
    margin-bottom:8px;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th,td{
    border:1px solid #333;
    padding:6px;
    text-align:center;
}
th{ background:#f0f0f0; }

.totals{
    text-align:right;
    margin-top:10px;
    font-size:14px;
}
</style>
</head>

<body>

<h1>Shree Laxmi Sales</h1>
<h2>Bill Generator</h2>

<div class="controls">
    <select id="month">
        <option value="0">January</option><option value="1">February</option>
        <option value="2">March</option><option value="3">April</option>
        <option value="4">May</option><option value="5">June</option>
        <option value="6">July</option><option value="7">August</option>
        <option value="8">September</option><option value="9">October</option>
        <option value="10">November</option><option value="11">December</option>
    </select>

    <select id="year">
        <option selected>2025</option>
        <option>2026</option>
        <option>2027</option>
        <option>2028</option>
        <option>2029</option>
        <option>2030</option>
        <option>2031</option>
        <option>2032</option>
        <option>2033</option>
        <option>2034</option>
        <option>2035</option>
        <option>2036</option>

    </select>

    <br><br>
    <button onclick="generateBills()">Generate Bills</button>
    <button onclick="downloadPDF()">Download PDF</button>
</div>

<div id="output"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script>
const { jsPDF } = window.jspdf;
const HSN = "7117";

/* Item rates */
const itemRates = {
  "Set":[165,175,190],
  "Chain":[12,15,20,35,80],
  "Pendal":[15,20,25,30],
  "Mangalsutra":[20,25,30,35],
  "Kanthi":[30,35,40],
  "Ring":[40,45,50]
};

/* Quantity limits */
const qtyLimits = {
  "Set":[1,3],
  "Chain":[3,20],
  "Pendal":[3,25],
  "Mangalsutra":[2,15],
  "Kanthi":[2,12],
  "Ring":[5,30]
};

/* Name → Place mapping */
const namePlace = {
  "Abhay":"Delhi",
  "Vijay":"Delhi",
  "Raj Kumar":"Delhi",
  "Sonu":"Delhi",
  "Tushar":"Delhi",
  "Naveen":"Delhi",
  "R.S":"Agra",
  "Jiva jewellery":"Agra",
  "V.I. Immitation":"Rajkot",
  "Pratham Traders":"Rajkot",
  "Vishnu Shankar Prasad":"Bihar"
};

let generatedBills=[];
let invoiceCounter=1;

function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function pick(arr){ return arr[rand(0,arr.length-1)]; }
function isSunday(d){ return d.getDay()===0; }

/* Split monthly target into bill targets */
function splitMonthlyTarget(total, parts){
    let splits=[], remaining=total;
    for(let i=0;i<parts-1;i++){
        let avg=remaining/(parts-i);
        let val=rand(avg*0.9,avg*1.1);
        val=Math.round(val/100)*100;
        splits.push(val);
        remaining-=val;
    }
    splits.push(remaining);
    return splits;
}

/* Adjust rate & quantity */
function adjustRateQty(rate,qty){
    if(rate>20){
        rate=Math.round(rate/2.5);
        qty*=2;
    }
    return {rate,qty};
}

function randomDates(y,m,c){
    let dates=[], days=new Date(y,m+1,0).getDate();
    while(dates.length<c){
        let d=new Date(y,m,rand(1,days));
        if(!isSunday(d)&&!dates.some(x=>x.toDateString()===d.toDateString()))
            dates.push(d);
    }
    return dates.sort((a,b)=>a-b);
}

function generateBills(){
    document.getElementById("output").innerHTML="";
    generatedBills=[];
    invoiceCounter=1;

    const m=parseInt(month.value);
    const y=parseInt(year.value);

    const billCount=rand(4,5);
    const dates=randomDates(y,m,billCount);

    const monthlyTarget=rand(43000,45000);
    const billTargets=splitMonthlyTarget(monthlyTarget,billCount);

    dates.forEach((date,idx)=>{
        let rows=[], billTotal=0, usedRates=new Set();

        const name=pick(Object.keys(namePlace));
        const place=namePlace[name];

        while(rows.length<rand(5,6)){
            let item=pick(Object.keys(itemRates));
            let rate=pick(itemRates[item]);
            if(usedRates.has(rate)) continue;
            usedRates.add(rate);

            let [q1,q2]=qtyLimits[item];
            let qty=rand(q1,q2);

            let adj=adjustRateQty(rate,qty);
            rate=adj.rate; qty=adj.qty;

            let amt=rate*qty;
            if(billTotal+amt>billTargets[idx]*1.05) continue;

            rows.push({item,qty,rate,amt});
            billTotal+=amt;
        }

        let diff=billTargets[idx]-billTotal;
        if(diff>0){
            let last=rows[rows.length-1];
            let addQty=Math.round(diff/last.rate);
            if(addQty>0){
                last.qty+=addQty;
                last.amt=last.qty*last.rate;
                billTotal+=addQty*last.rate;
            }
        }

        generatedBills.push({
            date,name,place,rows,billTotal,inv:invoiceCounter++
        });

        let igst=(billTotal*0.03).toFixed(2);
        let total=(billTotal*1.03).toFixed(2);

        document.getElementById("output").innerHTML+=`
        <div class="bill">
            <div class="bill-header">
                <div><b>Invoice:</b> INV/${y}/${String(invoiceCounter-1).padStart(3,"0")}</div>
                <div><b>Date:</b> ${date.toLocaleDateString()}</div>
                <div><b>Name:</b> ${name}</div>
                <div><b>Place:</b> ${place}</div>
            </div>

            <table>
                <tr>
                    <th>Sr</th><th>Description</th><th>HSN</th>
                    <th>Qty</th><th>Rate</th><th>Amount</th>
                </tr>
                ${rows.map((r,i)=>`
                <tr>
                    <td>${i+1}</td><td>${r.item}</td><td>${HSN}</td>
                    <td>${r.qty}</td><td>${r.rate}</td><td>${r.amt}</td>
                </tr>`).join("")}
            </table>

            <div class="totals">
                Total before GST ₹${billTotal}<br>
                IGST 3% ₹${igst}<br>
                <b>Total ₹${total}</b>
            </div>
        </div>`;
    });

    document.getElementById("output").innerHTML+=`
    <h3 style="text-align:right;color:green">
        Monthly Total: ₹${monthlyTarget}
    </h3>`;
}

function getMonthCode(monthIndex) {
    const codes = ["JAN","FEB","MAR","APR","MAY","JUN",
                   "JUL","AUG","SEP","OCT","NOV","DEC"];
    return codes[monthIndex];
}


function downloadPDF(){
    const pdf=new jsPDF("p","mm","a4");

    generatedBills.forEach((b,i)=>{
        if(i) pdf.addPage();
        pdf.setFontSize(16);
        pdf.text("Shree Laxmi Sales",105,12,{align:"center"});
        pdf.setFontSize(10);

        pdf.text(`Invoice: INV/${String(b.inv).padStart(3,"0")}`,14,22);
        pdf.text(`Date: ${b.date.toLocaleDateString()}`,150,22);
        pdf.text(`Name: ${b.name}`,14,28);
        pdf.text(`Place: ${b.place}`,150,28);

        pdf.autoTable({
            startY:35,
            head:[["Sr","Item","HSN","Qty","Rate","Amount"]],
            body:b.rows.map((r,i)=>[i+1,r.item,HSN,r.qty,r.rate,r.amt]),
            styles:{fontSize:9}
        });

        let y=pdf.lastAutoTable.finalY+6;
        const totalBeforeGST = b.billTotal.toFixed(2);
        const igst = (b.billTotal * 0.03).toFixed(2);
        const totalAmount = (b.billTotal * 1.03).toFixed(2);
        
        pdf.setFont("helvetica", "normal");
        pdf.setFontSize(11);
        
        // shift X position to avoid clipping
        pdf.text(`Total before GST : ₹ ${totalBeforeGST}`, 20, y);
        pdf.text(`IGST @ 3%        : ₹ ${igst}`, 20, y + 8);
        pdf.text(`Total Amount    : ₹ ${totalAmount}`, 20, y + 16);

    });

    const m = parseInt(document.getElementById("month").value);
    const y = document.getElementById("year").value;
    
    const fileName = `SLS_${getMonthCode(m)}_${y}_Bill.pdf`;
    pdf.save(fileName);

}
</script>

</body>
</html>
