<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Laxmi Sales â€“ Bill Generator</title>

<style>
body{
    font-family:"Segoe UI",Arial,sans-serif;
    background:#f4f6f8;
    padding:20px;
}
h1{text-align:center;margin-bottom:4px;}
h2{text-align:center;color:#666;margin-top:0;}
.controls{text-align:center;margin:20px 0;}
select,button{padding:8px 14px;font-size:14px;margin:5px;}
button{
    background:#2c3e50;color:white;border:none;
    border-radius:6px;cursor:pointer;
}
button:hover{background:#1f2d3a;}
.bill{
    background:white;margin:20px 0;padding:15px;
    border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.bill-header{
    display:flex;justify-content:space-between;
    flex-wrap:wrap;font-size:14px;margin-bottom:8px;
}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #333;padding:6px;text-align:center;}
th{background:#f0f0f0;}
.totals{text-align:right;margin-top:10px;font-size:14px;}
</style>
</head>

<body>

<h1>Shree Laxmi Sales</h1>
<h2>Bill Generator</h2>

<div class="controls">
<select id="month">
<option value="0">January</option><option value="1">February</option>
<option value="2">March</option><option value="3">April</option>
<option value="4">May</option><option value="5">June</option>
<option value="6">July</option><option value="7">August</option>
<option value="8">September</option><option value="9">October</option>
<option value="10">November</option><option value="11">December</option>
</select>

<select id="year">
<option selected>2025</option><option>2026</option><option>2027</option>
</select>

<br><br>
<button onclick="generateBills()">Generate Bills</button>
<button onclick="downloadPDF()">Download PDF</button>
</div>

<div id="output"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script>
const { jsPDF } = window.jspdf;
const output=document.getElementById("output");
const HSN="7117";
const MAX_QTY=300;

/* Rates */
const itemRates={
Set:[165,175,190],
Chain:[12,15,20,35],
Pendal:[15,20,25,30],
Mangalsutra:[20,25,30],
Kanthi:[30,35,40],
Ring:[40,45,50]
};

/* Qty limits */
const qtyLimits={
Set:[5,60],
Chain:[30,300],
Pendal:[30,300],
Mangalsutra:[20,200],
Kanthi:[20,200],
Ring:[30,300]
};

/* Name â†’ Place */
const namePlace={
Abhay:"Delhi",Vijay:"Delhi","Raj Kumar":"Delhi",Sonu:"Delhi",
Tushar:"Delhi",Naveen:"Delhi","R.S":"Agra",
"Jiva jewellery":"Agra","V.I. Immitation":"Rajkot",
"Pratham Traders":"Rajkot","Vishnu Shankar Prasad":"Bihar"
};

let generatedBills=[],invoiceCounter=1;

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function pick(a){return a[rand(0,a.length-1)];}
function isSunday(d){return d.getDay()===0;}
function recalc(rows){return rows.reduce((s,r)=>s+r.qty*r.rate,0);}

function randomDates(y,m,c){
let d=[],days=new Date(y,m+1,0).getDate();
while(d.length<c){
let x=new Date(y,m,rand(1,days));
if(!isSunday(x)&&!d.some(z=>z.toDateString()==x.toDateString()))d.push(x);
}
return d.sort((a,b)=>a-b);
}

/* ðŸ”¥ OPTION-C DISTRIBUTION */
function generateBillTargets(monthTotal,billCount){
let t=[];
if(billCount===4){
let low=rand(4000,7000);
let high=rand(13000,18000);
let rem=monthTotal-low-high;
let mid1=rand(8000,12000);
let mid2=rem-mid1;
t=[low,high,mid1,mid2];
}else{
let low=rand(4000,7000);
let high=rand(13000,17000);
let rem=monthTotal-low-high;
let mid1=rand(7000,10000);
let mid2=rand(7000,10000);
let mid3=rem-mid1-mid2;
t=[low,high,mid1,mid2,mid3];
}
for(let i=t.length-1;i>0;i--){
let j=Math.floor(Math.random()*(i+1));
[t[i],t[j]]=[t[j],t[i]];
}
return t;
}

function generateBills(){
output.innerHTML="";
generatedBills=[];invoiceCounter=1;

const m=parseInt(month.value),y=parseInt(year.value);
const billCount=rand(4,5);
const monthTotal=rand(40000,45000);
const billTargets=generateBillTargets(monthTotal,billCount);
const dates=randomDates(y,m,billCount);

dates.forEach((date,idx)=>{
let rows=[],usedRates=new Set();
let target=billTargets[idx];
let billTotal=0;

const name=pick(Object.keys(namePlace));
const place=namePlace[name];
const items=rand(5,6);

for(let i=0;i<items;i++){
let item=pick(Object.keys(itemRates));
let rate=pick(itemRates[item]);
if(usedRates.has(rate))continue;
usedRates.add(rate);

let[q1,q2]=qtyLimits[item];
let qty=rand(q1,q2);
qty=Math.min(qty,MAX_QTY);

rows.push({item,qty,rate,amt:qty*rate});
billTotal+=qty*rate;
}

/* normalize to target */
while(billTotal>target){
for(let r of rows){
if(r.qty>1){
r.qty--;
r.amt=r.qty*r.rate;
billTotal=recalc(rows);
if(billTotal<=target)break;
}
}
}
while(billTotal<target*0.95){
for(let r of rows){
if(r.qty<MAX_QTY){
r.qty++;
r.amt=r.qty*r.rate;
billTotal=recalc(rows);
if(billTotal>=target*0.95)break;
}
}
}

billTotal=recalc(rows);

generatedBills.push({
date,name,place,rows,billTotal,inv:invoiceCounter++
});
});

/* render */
let monthlySum=0;
generatedBills.forEach(b=>{
monthlySum+=b.billTotal;
let igst=(b.billTotal*0.03).toFixed(2);
let total=(b.billTotal*1.03).toFixed(2);
output.innerHTML+=`
<div class="bill">
<div class="bill-header">
<div><b>Invoice:</b> INV/${y}/${String(b.inv).padStart(3,"0")}</div>
<div><b>Date:</b> ${b.date.toLocaleDateString()}</div>
<div><b>Name:</b> ${b.name}</div>
<div><b>Place:</b> ${b.place}</div>
</div>
<table>
<tr><th>Sr</th><th>Description</th><th>HSN</th><th>Qty</th><th>Rate</th><th>Amount</th></tr>
${b.rows.map((r,i)=>`
<tr><td>${i+1}</td><td>${r.item}</td><td>${HSN}</td>
<td>${r.qty}</td><td>${r.rate}</td><td>${r.amt}</td></tr>`).join("")}
</table>
<div class="totals">
Total before GST â‚¹${b.billTotal}<br>
IGST 3% â‚¹${igst}<br>
<b>Total â‚¹${total}</b>
</div>
</div>`;
});

output.innerHTML+=`
<h3 style="text-align:right;color:green">
Monthly Total: â‚¹${monthlySum}
</h3>`;
}

function getMonthCode(m){
return["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][m];
}

function downloadPDF(){
const pdf=new jsPDF("p","mm","a4");
generatedBills.forEach((b,i)=>{
if(i)pdf.addPage();
pdf.text("Shree Laxmi Sales",105,12,{align:"center"});
pdf.text(`Invoice: INV/${String(b.inv).padStart(3,"0")}`,14,22);
pdf.text(`Date: ${b.date.toLocaleDateString()}`,150,22);
pdf.text(`Name: ${b.name}`,14,28);
pdf.text(`Place: ${b.place}`,150,28);
pdf.autoTable({
startY:35,
head:[["Sr","Item","HSN","Qty","Rate","Amount"]],
body:b.rows.map((r,i)=>[i+1,r.item,HSN,r.qty,r.rate,r.amt])
});
let y=pdf.lastAutoTable.finalY+6;
pdf.text(`Total before GST : â‚¹ ${b.billTotal.toFixed(2)}`,20,y);
pdf.text(`IGST @3%        : â‚¹ ${(b.billTotal*0.03).toFixed(2)}`,20,y+8);
pdf.text(`Total Amount    : â‚¹ ${(b.billTotal*1.03).toFixed(2)}`,20,y+16);
});
pdf.save(`SLS_${getMonthCode(parseInt(month.value))}_${year.value}_Bill.pdf`);
}
</script>

</body>
</html>
